var temperature = "";
var windSpeed = "";
var windDirection = "";
var windChill = "";
var sunrise = "";
var sunset = "";
var high = "";
var low = "";
var condition = "";
var todaysHigh = "";
var todaysLow = "";

blankLabels();

onEvent("CityInput","change",function(){
  console.log(getText("CityInput"));
  getWeather(getText("CityInput"));
  setWeatherIcon(condition);
  updateLabels();
});

function updateLabels(){
  setText("conditionLabel",condition);
  setText("tempLabel",temperature + "Â°F");
  setText("todaysHighLabel",todaysHigh);
  showElement("CurrentWeatherLabel");
  showElement("laterTodayLabel");
}

function getWeather(city){
  var query = encodeURI('select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="' + city + '")');
  var url = "https://query.yahooapis.com/v1/public/yql?q=" + query+"&format=json"; 
  try{
    startWebRequest(url, function(status, type, content) {
      var jsonData = JSON.parse(content);
      //console.log(jsonData);
      parseJSON(jsonData);
      console.log(temperature);
    });
  } catch(SyntaxError){}
}

function blankLabels() {
  setText("conditionLabel","");
  setText("todaysHighLabel","");
  setText("todaysLowLabel","");
}

function setWeatherIcon(condition){
  switch(condition.toLowerCase()){
                case "partly cloudy":
                  setIcon("partlyCloudyImage");
                  break;
                case "mostly cloudy":
                  setIcon("partlyCloudyImage");
                  break;
                case "breezy":
                  setIcon("sunnyImage");
                  break;
                case "foggy":
                  setIcon("foggyImage");
                  break;
                case "showers":
                  setIcon("rainImage");
                  break;
                case "drizzle":
                  setIcon("littleRainImage");
                  break;
                case "cloudy":
                  setIcon("cloudyImage");
                  break;
                case "sleet":
                  setIcon("sleetImage");
                  break;
                case "flurries":
                  setIcon("snowImage");
                  break;
                case "snow showers":
                  setIcon("snowImage");
                  break;
                case "snow":
                  setIcon("snowImage");
                  break;
                case "isolated thunderstorms":
                  setIcon("stormImage");
                  break;
                case "scattered thunderstorms":
                  setIcon("stormImage");
                  break;
                case "isolated thundershowers":
                  setIcon("stormImage");
                  break;
                default:
                  setIcon("sunnyImage");
                  break;
  }
}

function setIcon(icon){
  hideElement("foggyImage");
  hideElement("cloudyImage");
  hideElement("littleRainImage");
  hideElement("partlyCloudyImage");
  hideElement("rainImage");
  hideElement("sleetImage");
  hideElement("snowImage");
  hideElement("stormImage");
  hideElement("sunnyImage");
  showElement(icon);
}

function parseJSON(jsonData){
  temperature =   jsonData.query.results.channel.item.condition.temp;
  windSpeed =     jsonData.query.results.channel.wind.speed;
  windDirection = jsonData.query.results.channel.wind.direction;
  windChill =     jsonData.query.results.channel.wind.chill;
  sunrise =       jsonData.query.results.channel.astronomy.sunrise;
  sunset =        jsonData.query.results.channel.astronomy.sunset;
  high =          jsonData.query.results.channel.item.forecast.high;
  low =           jsonData.query.results.channel.item.forecast.low;
  condition =     jsonData.query.results.channel.item.condition.text;
  todaysHigh =    //jsonData.query.results.channel.item.forecast.split("{")[0].split(",")[3].split(":")[1].split("\"")[3];
  todaysHigh = String(jsonData.query.results.channel.item.forecast[0].high);
  todaysLow = String(jsonData.query.results.channel.item.forecast[0].low);
  console.log(todaysHigh);
  console.log(todaysLow);
}
